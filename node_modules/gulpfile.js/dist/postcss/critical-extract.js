"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const postcss_1 = __importDefault(require("postcss"));
/**
 * Extract critical rules.
 */
exports.default = postcss_1.default.plugin("critical-extract", () => {
    return (css) => {
        const criticals = [];
        css.walk((node) => {
            // Treat `@critical` nodes.
            if (node.type === "atrule" && node.name === "critical") {
                // Save children nodes.
                node.clone().each((child) => {
                    if (child.type !== "atrule" || child.name !== "critical") {
                        criticals.push(child);
                    }
                });
            }
            // Treat `critical: this` nodes.
            if (node.type === "decl" && node.prop === "critical" && node.value === "this") {
                const parent = node.parent.clone();
                // Remove all `critical` nodes.
                parent.walkDecls("critical", (decl) => {
                    decl.remove();
                });
                // Save current node.
                criticals.push(parent);
            }
        });
        css.removeAll().append(criticals);
    };
});
//# sourceMappingURL=critical-extract.js.map